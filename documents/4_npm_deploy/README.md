# npm ë°°í¬í•˜ê¸°

1. npmì— ë°°í¬í•˜ê¸° ì•ì„œ ì„¤ì •ì„ í•´ì£¼ì–´ì•¼ í•©ë‹ˆë‹¤.

<br />

`package.json`
```json
{
  "name": "npmì— ë°°í¬í•  íŒŒì¼ëª…(ì¤‘ë³µë¶ˆê°€)",
  "version": "v0.
  0.1", // npmì— ë°°í¬í•  ë²„ì „ëª…(ì¤‘ë³µë¶ˆê°€)
  "main": "lib/index.js",
  "module": "lib/index.esm.js", // ì‚¬ìš©ìê°€ íŒ¨í‚¤ì§€ ë‹¤ìš´ë°›ì•„ ì‚¬ìš©í•  ë•Œ ì ‘ê·¼í•˜ëŠ” entryíŒŒì¼
  "types": "lib/index.d.ts",
  "files": [
      "lib"
  ],
  // npmì—ì„œ ì‚¬ìš©í•  keywordsì™€ descriptionë„ ìˆ˜ì •í•´ì£¼ì (ì„ íƒ)
  // ...
  "license": "MIT",
  // ...
  "scripts": {
    "build": "rollup -c",
    // ...
  }
  // ...
}
```
   
<br/><br/>

2. rollup ì„¤ì • íŒŒì¼ ë§Œë“¤ê¸°
   
<br /> 

ì½”ë“œë¥¼ ê·¸ëŒ€ë¡œ ì˜¬ë¦´ ìˆ˜ëŠ” ì—†ìœ¼ë‹ˆ ë²ˆë“¤ë§ì„ í•´ì£¼ê¸° ìœ„í•´ rollupì„ ì„¤ì •í•©ë‹ˆë‹¤. rollupì€ commonjsë°©ì‹ ì´ë‚˜ esm ë°©ì‹ìœ¼ë¡œ ë§Œë“  ì™¸ë¶€ íŒ¨í‚¤ì§€ë¥¼ ë³„ë„ì˜ ì„¤ì •ì—†ì´ ë²ˆë“¤ë§ í•´ì£¼ëŠ” ì¥ì ì´ ìˆì–´ ì‰½ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

<br />
   
`rollup.config.js`
```javascript
import peerDepsExternal from 'rollup-plugin-peer-deps-external';
import { nodeResolve } from '@rollup/plugin-node-resolve';
import typescript from 'rollup-plugin-typescript2';
import path from 'path';
import sass from 'rollup-plugin-sass';
import commonjs from '@rollup/plugin-commonjs';

import packageJson from './package.json';

export default {
    input: 'src/index.tsx',
    output: [
        {
            dir:"lib",
            format: 'cjs',
            sourcemapPathTransform: (relativePath) => {
              return path.relative('src', relativePath);
            },
            sourcemap: true,
        },
    ],
    plugins: [
        peerDepsExternal(),
        nodeResolve({
            browser: true,
        }),

        typescript({ objectHashIgnoreUnknownHack: true }),
        commonjs({
          include: /node_modules/,
        }),
        sass({
            insert: true,
        })
    ],
};
```

<br/><br/>

3. `npm run build`

4. .npmignore íŒŒì¼ ì¶”ê°€
   
```text
# Logs
logs
*.log
npm-debug.log*
yarn-debug.log*
yarn-error.log*

# Runtime data
pids
*.pid
*.seed
*.pid.lock

# Directory for instrumented libs generated by jscoverage/JSCover
lib-cov

# Coverage directory used by tools like istanbul
coverage

# nyc test coverage
.nyc_output

# Grunt intermediate storage (http://gruntjs.com/creating-plugins#storing-task-files)
.grunt

# Bower dependency directory (https://bower.io/)
bower_components

# node-waf configuration
.lock-wscript

# Compiled binary addons (http://nodejs.org/api/addons.html)
build/Release

# Dependency directories
node_modules/
jspm_packages/

# Typescript v1 declaration files
typings/

# Optional npm cache directory
.npm

# Optional eslint cache
.eslintcache

# Optional REPL history
.node_repl_history

# Output of 'npm pack'
*.tgz

# Yarn Integrity file
.yarn-integrity

# dotenv environment variables file
.env

# Only apps should have lockfiles
npm-shrinkwrap.json
package-lock.json
yarn.lock
```
   
5. npm ë°°í¬í•˜ê¸°

```bash
$ npm login
$ npm whoami
$ npm publish --access=public
```

<br />
<br />

## npm ë°°í¬ ìë™í™”
ì´ì œ semantic-release íŒ¨í‚¤ì§€ë¥¼ ì´ìš©í•˜ì—¬ ìœ„ì˜ í™œë™ë“¤ì„ ìë™í™” í•©ë‹ˆë‹¤.
> semantic-releaseëŠ” npm ë°°í¬ë¥¼ ìë™í™” í•˜ëŠ” íŒ¨í‚¤ì§€ì…ë‹ˆë‹¤.

<br />

- [semantic-release](https://github.com/semantic-release/semantic-release)
- [semantic-release youtube tutorial](https://www.youtube.com/watch?v=iKeCt0F1XLg)

<br />

1. commitlint ì¶”ê°€
```bash
$ npm i -D @commitlint/cli @commitlint/config-conventional husky
```

`package.json`
```json
{
  //...
  "commitlint": {
    "extends": [
      "@commitlint/config-conventional"
    ]
  },
  "husky": {
      "hooks": {
          "commit-msg": "commitlint -E HUSKY_GIT_PARAMS"
      }
  }
}
```

> commitlintë¥¼ ì¶”ê°€í•˜ëŠ” ì´ìœ ëŠ” semantic-releaseê°€ `fix:`ì™€ `feat:` ìœ¼ë¡œ ì‹œì‘í•˜ëŠ” ì»¤ë°‹ë©”ì‹œì§€ì— ë°˜ì‘í•˜ì—¬ ê¸°ì¡´ ì½”ë“œì™€ì˜ ë³€í™”ë¥¼ ê°ì§€í•˜ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.

<br />

2. npm access token ë°œê¸‰ë°›ê¸°
   [í† í° ë°œê¸‰](https://www.npmjs.com/settings/nodelab/tokens) > Generate New Token > Publish ì²´í¬ > ë°œê¸‰ë°›ì€ í† í°ì„ git actions secrects ë³€ìˆ˜ì— ì¶”ê°€(í™˜ê²½ë³€ìˆ˜ ëª…ì€ NPM_TOKEN)
   
   > ìµœì¢…ì ìœ¼ë¡œ ë‘ê°œì˜ secret keyë¥¼ ë°œê¸‰ ë°›ì•˜ìŠµë‹ˆë‹¤.

   ![](./images/screenshot-1.png)

3. package.json ìˆ˜ì •
ë°°í¬í• ë•Œë§ˆë‹¤ ë²„ì „ëª…ì´ ë‹¬ë¼ì ¸ì•¼ í•˜ë¯€ë¡œ ì•„ë˜ì™€ ê°™ì´ ìˆ˜ì •

```json
{
  "version": "0.0.0-semantically-released",
}
```

4. git actions yml ìˆ˜ì •

```yml
name: Node.js Package

on:
    push:
        branches: [master]

jobs:
    publish-gpr:
        runs-on: ubuntu-latest
        steps:
            - uses: actions/checkout@v2
            - uses: actions/setup-node@v1
              with:
                  node-version: 12
                  registry-url: https://npm.pkg.github.com/

            - run: npm install
            - name: Deploy Storybook
              run: npm run deploy-storybook -- --ci
              env:
                  GH_TOKEN: ì—¬ëŸ¬ë¶„ì˜ ê³„ì •ëª…:${{ secrets.GH_TOKEN }}
            - run: npm run build
            - name: Release
              run: npx semantic-release
              env:
                  GITHUB_TOKEN: ${{ secrets.GH_TOKEN }}
                  NPM_TOKEN: ${{ secrets.NPM_TOKEN }}
```

<br /><br />

5. git actions yml ìˆ˜ì •
   
<br />
  
ì´ì œ ê¹ƒí—ˆë¸Œì— pushí•˜ë©´ ìë™ìœ¼ë¡œ npmê³¼ storybookì— ë°°í¬ê°€ ì™„ë£Œë©ë‹ˆë‹¤.

<br />

![](./images/screenshot-3.png)

<br />

## ìˆ˜ê³ í•˜ì…¨ìŠµë‹ˆë‹¤.
ì´ì œ ìì‹ ë§Œì˜ ë””ìì¸ ì‹œìŠ¤í…œì„ ë§Œë“¤ ìˆ˜ ìˆê² êµ°ìš” <br />
ì—¬ëŸ¬ë¶„ë“¤ì€ ë” ë‚˜ì•„ê°€ `jest`, `lintstage`, `eslint`, `prettier`ë¥¼ huskyì— ì¶”ê°€í•˜ì—¬ ì»¤ë°‹ì„ í• ë•Œë§ˆë‹¤ ì½”ë“œë¥¼ í…ŒìŠ¤íŠ¸í•  ìˆ˜ ìˆê²Œ ë§Œë“¤ì–´ ë³´ëŠ” ê²ƒë„ ì¢‹ì„ ê²ƒ ê°™ìŠµë‹ˆë‹¤. ğŸ˜<br />
ë˜í•œ, ìì‹ ë§Œì˜ storybook ì‚¬ìš©ë²•ì„ ë§Œë“¤ì–´ ê°€ì‹œëŠ” ê²ƒë„ ì¢‹ì„ ê²ƒ ê°™ì•„ìš”. <br />
ê°ì‚¬í•©ë‹ˆë‹¤. ğŸ˜ğŸ˜

<br />
<br />

ì¶”ê°€ë¡œ ê¶ê¸ˆí•œ ì ì´ ìˆìœ¼ì‹œë©´ ì–¸ì œë“ ì§€ ì—°ë½ì£¼ì„¸ìš” ... by **Jod** ğŸ”¥ <br />
email: jodmsoluth@gmail.com <br />

<br />

## ë§ˆë¬´ë¦¬
0. ìŠ¤í† ë¦¬ë¶ ì„¸íŒ…í•˜ê¸°
1. ì²«ë²ˆì§¸ ì»´í¬ë„ŒíŠ¸ 
2. ìŠ¤í† ë¦¬ë¶ìœ¼ë¡œ docsì‘ì„±í•˜ê¸°
3. ìŠ¤í† ë¦¬ë¶ ë°°í¬í•˜ê¸°
4. **NPMì— ë°°í¬í•˜ê¸°**